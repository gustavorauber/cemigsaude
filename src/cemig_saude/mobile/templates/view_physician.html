{% extends "index.html" %}

{% block page_id %}physician-page{% endblock %}

{% block header %}
<h1>{{physician.get_name|title}}</h1>
{% endblock %}          

{% block content %}
<div class="ui-bar-c ui-corner-all ui-shadow" style="padding: 1em;" id="view-physician-page">
    <table data-role="table" data-mode="reflow" id="physician-data">
        <thead>
	        <tr>
	           <th>Especialidade(s)</th>
	           <th>Registro Profissional</th>
	           <th>Telefone</th>
	           {% if self.get_email %}
	               <th>E-Mail</th>
	           {% endif %}
	           <th>Endereço</th>
	        </tr>
	    </thead>
	    <tbody>
	        <tr>
	           <td>{{physician.get_specialty|title}}</td>
	           <td>{{physician.get_register}}</td>
	           <td><a href="tel:{{physician.get_phone}}">{{physician.get_phone}}</a></td>
	           {% if self.get_email %}
	               <td><a href="mailto:{{physician.get_email}}">{{physician.get_email}}</a></td>
	           {% endif %}
	           <td><a href="geo:{{physician.get_lat}},{{physician.get_lon}};u=35">{{physician.get_street_address|title}}, {{physician.get_neighborhood}}, {{physician.get_city|title}}</a></td>
	        </tr>
	    </tbody>
    </table>
</div>
<br />
<div class="ui-bar-c ui-corner-all ui-shadow" style="padding: 1em;">
    <div id="physician-map" style="height:400px;"></div>
</div>
{% endblock %}    

{% block javascript %}
<script type="text/javascript">
$(document).on("pageshow", "#physician-page", function(event) {
	
	var myLatlng = new google.maps.LatLng({{physician.get_lat}}, {{physician.get_lon}});
    var mapOptions = {
      zoom: 15,
      center: myLatlng
    };

    $('#physician-map').empty();
    window.map = new google.maps.Map(document.getElementById('physician-map'), mapOptions);
    var bounds = new google.maps.LatLngBounds();
    var infoWindow = new google.maps.InfoWindow();

    var contentString = '<div>'+
        '<div id="siteNotice">'+
        '</div>'+
        '<h2 class="firstHeading">{{physician.get_name|title}}</h2>'+
        '<div>'+
        '<p><b>Especialidade(s)</b>: {{physician.get_specialty|title}} ' +
        '<p><b>Endereço</b>: {{physician.get_street_address|title}} ' +      
        '</div>'+
        '</div>';

    infoWindow.setContent(contentString);

    var marker = new google.maps.Marker({
        position: myLatlng,
        map: window.map,
        title: '{{physician.get_name|title}}'
    });

    bounds.extend(myLatlng);
    google.maps.event.addListener(marker, 'click', function() {
    	infoWindow.open(window.map, marker);
    });    
    
    google.maps.event.trigger(marker, 'click');
    //google.maps.event.trigger(window.map, 'resize');
    //window.map.setCenter(myLatlng);
});
</script>    
{% endblock %}
